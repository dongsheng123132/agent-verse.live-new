# Grid Shop MVP — Cursor 项目上下文

## 项目简介
100×100 像素格子售卖平台（百万格子），基于 Next.js 14 + PostgreSQL + Coinbase Commerce USDC 支付。

## 技术栈
- Next.js 14.2 App Router (混用 JS/TS)
- PostgreSQL (Neon) — 通过 `lib/db.js` 的 `dbQuery(sql, params)` 访问
- Tailwind CSS (CDN，非本地安装)
- Coinbase Commerce API 支付
- x402 协议 AI 付款

## 关键约定
- Cell ID = y * 100 + x
- Block ID 格式: `blk_{x}_{y}_{w}x{h}`
- API Key 格式: `gk_<32hex>`，SHA-256 存库
- 所有 API 路由在 `app/api/` 下，使用 Next.js Route Handlers
- 数据库操作统一用 `import { dbQuery } from '@/lib/db.js'`
- 事件记录用 `import { logEvent } from '@/lib/events.js'`

## 文件导航
- 定价: `lib/pricing.js` — BLOCK_SIZES 数组
- 支付: `app/api/commerce/create/route.js` + `verify/route.js`
- 格子管理: `app/api/cells/update/route.js` (PUT, API Key 鉴权)
- 前端: `app/page.tsx` (单文件客户端组件)
- 数据库 Schema: `scripts/init-db.sql`
- 完整文档: `docs/PRD.md`, `docs/TECHNICAL.md`, `docs/DEVELOPMENT.md`

## API 列表
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/grid | 所有已售格子 |
| GET | /api/cells?x=&y= | 单格详情 |
| POST | /api/commerce/create | 创建支付 |
| GET | /api/commerce/verify?receipt_id= | 验证支付 |
| POST | /api/cells/purchase | x402 付款 |
| PUT | /api/cells/update | 更新格子内容 (Bearer gk_xxx) |
| POST | /api/cells/regen-key | 重新生成 Key |
| GET | /api/search?q= | 全文搜索 |
| GET | /api/events?limit= | 事件列表 |
| GET | /api/rankings | 排名 |

## 开发命令
```bash
npm run dev      # localhost:3005
npm run build    # 生产构建
psql $DATABASE_URL -f scripts/init-db.sql  # 初始化/迁移数据库
```
